(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{102:function(e,t,n){},133:function(e,t,n){"use strict";n.r(t);var a=n(1),c=n.n(a),r=n(24),s=n.n(r),i=(n(78),n(5)),o=n(72),l=n(0),u=function(){return Object(l.jsx)("div",{className:"loader"})},d=n(4),j=n(2),b=n.n(j),m=n(6),h=n(7),p=n(9),f=n.n(p),O=function(e){e?f.a.defaults.headers.common.Authorization="".concat(e):delete f.a.defaults.headers.common.Authorization},x=function(e,t){var n=t.type,a=t.payload,c=a.isAuthenticated,r=a.user;switch(n){case"SET_AUTH":return Object(i.a)(Object(i.a)({},e),{},{loading:!1,isAuthenticated:c,user:r});default:return e}},v="userChat",g=Object(a.createContext)(),N=function(e){var t=e.children,n=Object(a.useReducer)(x,{loading:!0,isAuthenticated:!1,user:null}),c=Object(h.a)(n,2),r=c[0],s=c[1],i=function(){var e=Object(m.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return localStorage.userChat&&O(localStorage.userChat),e.prev=1,e.next=4,f.a.get("/api/auth/infor");case 4:(t=e.sent).data.success&&s({type:"SET_AUTH",payload:{loading:!1,isAuthenticated:!0,user:t.data.user}}),e.next=14;break;case 8:e.prev=8,e.t0=e.catch(1),console.log(e.t0),localStorage.removeItem(v),O(null),s({type:"SET_AUTH",payload:{isAuthenticated:!1,user:null}});case 14:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(){return e.apply(this,arguments)}}();Object(a.useEffect)((function(){return i()}),[]);var o={login:function(){var e=Object(m.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.a.post("/api/auth/login",t);case 3:return(n=e.sent).data.success&&localStorage.setItem(v,n.data.accessToken),e.next=7,i();case 7:return e.abrupt("return",n.data);case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",e.t0.response.data?e.t0.response.data:{success:!1,message:e.t0.message});case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),register:function(){var e=Object(m.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.a.post("/api/auth/register",t);case 3:return(n=e.sent).data.success&&localStorage.setItem(v,n.data.accessToken),e.next=7,i();case 7:return e.abrupt("return",n.data);case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",e.t0.response.data?e.t0.response.data:{success:!1,message:e.t0.message});case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),authState:r,logout:function(){var e=Object(m.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:localStorage.removeItem(v),s({type:"SET_AUTH",payload:{isAuthenticated:!1,user:null}});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()};return Object(l.jsx)(g.Provider,{value:o,children:t})},w=["component"],_=function(e){var t=e.component,n=Object(o.a)(e,w),c=Object(a.useContext)(g).authState,r=c.loading,s=c.isAuthenticated;return r?Object(l.jsx)(u,{}):Object(l.jsx)(d.b,Object(i.a)(Object(i.a)({},n),{},{render:function(e){return s?Object(l.jsx)(l.Fragment,{children:Object(l.jsx)(t,Object(i.a)(Object(i.a)({},n),e))}):Object(l.jsx)(d.a,{to:"/login"})}}))},y=n(21),k=(n(102),n(23)),S=n(136),C=function(e){var t=e.info;return null===t?null:Object(l.jsx)(S.a,{variant:t.type,children:t.message})},E=function(){var e=Object(a.useContext)(g).login,t=Object(a.useState)({username:"",password:""}),n=Object(h.a)(t,2),c=n[0],r=n[1],s=c.username,o=c.password,u=Object(a.useState)(null),d=Object(h.a)(u,2),j=d[0],p=d[1],f=function(e){r(Object(i.a)(Object(i.a)({},c),{},Object(k.a)({},e.target.name,e.target.value)))},O=function(){var t=Object(m.a)(b.a.mark((function t(n){var a;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.preventDefault(),t.prev=1,t.next=4,e(c);case 4:(a=t.sent).success||(p({type:"danger",message:a.message}),setTimeout((function(){return p(null)}),5e3)),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),console.log(t.t0);case 11:case"end":return t.stop()}}),t,null,[[1,8]])})));return function(e){return t.apply(this,arguments)}}();return Object(l.jsx)(a.Fragment,{children:Object(l.jsx)("div",{className:"row wrapper",children:Object(l.jsx)("div",{className:"col-10 col-lg-5",children:Object(l.jsxs)("form",{className:"shadow-lg",onSubmit:O,children:[Object(l.jsx)("h1",{className:"mb-3 title",children:"Chat App"}),Object(l.jsx)("h3",{className:"mb-3 title",children:"\u0110\u0103ng Nh\u1eadp"}),Object(l.jsxs)("div",{className:"form-group",children:[Object(l.jsx)("label",{htmlFor:"username_field",children:"Username"}),Object(l.jsx)("input",{type:"name",className:"form-control",name:"username",value:s,onChange:f})]}),Object(l.jsxs)("div",{className:"form-group",children:[Object(l.jsx)("label",{htmlFor:"password_field",children:"M\u1eadt kh\u1ea9u"}),Object(l.jsx)("input",{type:"password",id:"password_field",className:"form-control",name:"password",value:o,onChange:f})]}),Object(l.jsx)(C,{info:j}),Object(l.jsx)("button",{type:"submit",className:"btn btn-block mt-4",children:"\u0110\u0103ng nh\u1eadp"}),Object(l.jsx)(y.b,{to:"/register",className:"d-flex justify-content-center mt-3",children:"T\u1ea1o t\xe0i kho\u1ea3n?"})]})})})})},A=function(){var e=Object(a.useContext)(g).register,t=Object(a.useState)({fullname:"",username:"",password:"",confirmPassword:""}),n=Object(h.a)(t,2),c=n[0],r=n[1],s=c.fulname,o=c.username,u=c.password,d=c.confirmPassword,j=Object(a.useState)(null),p=Object(h.a)(j,2),f=p[0],O=p[1],x=function(e){r(Object(i.a)(Object(i.a)({},c),{},Object(k.a)({},e.target.name,e.target.value)))},v=function(){var t=Object(m.a)(b.a.mark((function t(n){var a;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.preventDefault(),u===d){t.next=5;break}return O({type:"danger",message:"M\u1eadt kh\u1ea9u kh\xf4ng kh\u1edbp \ud83d\ude1e"}),setTimeout((function(){return O(null)}),5e3),t.abrupt("return");case 5:return t.prev=5,t.next=8,e(c);case 8:(a=t.sent).success||(O({type:"danger",message:a.message}),setTimeout((function(){return O(null)}),5e3)),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(5),console.log(t.t0);case 15:case"end":return t.stop()}}),t,null,[[5,12]])})));return function(e){return t.apply(this,arguments)}}();return Object(l.jsx)("div",{className:"row wrapper",children:Object(l.jsx)("div",{className:"col-10 col-lg-5",children:Object(l.jsxs)("form",{className:"shadow-lg mb-5",onSubmit:v,children:[Object(l.jsx)("h1",{className:"mb-3 title",children:"Chat App"}),Object(l.jsx)("h3",{className:"mb-3 title",children:"\u0110\u0103ng k\xfd"}),Object(l.jsxs)("div",{className:"form-group",children:[Object(l.jsx)("label",{htmlFor:"fullname_field",children:"H\u1ecd t\xean"}),Object(l.jsx)("input",{type:"name",className:"form-control",name:"fullname",value:s,onChange:x})]}),Object(l.jsxs)("div",{className:"form-group",children:[Object(l.jsx)("label",{htmlFor:"username_field",children:"Username"}),Object(l.jsx)("input",{type:"name",className:"form-control",name:"username",value:o,onChange:x})]}),Object(l.jsxs)("div",{className:"form-group",children:[Object(l.jsx)("label",{htmlFor:"password_field",children:"M\u1eadt kh\u1ea9u"}),Object(l.jsx)("input",{type:"password",className:"form-control",name:"password",value:u,onChange:x})]}),Object(l.jsxs)("div",{className:"form-group",children:[Object(l.jsx)("label",{htmlFor:"cf_password_field",children:"X\xe1c nh\u1eadn m\u1eadt kh\u1ea9u"}),Object(l.jsx)("input",{type:"password",className:"form-control",name:"confirmPassword",value:d,onChange:x})]}),Object(l.jsx)(C,{info:f}),Object(l.jsx)("button",{type:"submit",className:"btn btn-block mt-4",children:"\u0110\u0103ng k\xfd"}),Object(l.jsx)(y.b,{to:"/login",className:"d-flex justify-content-center mt-3",children:"\u0110\u0103ng nh\u1eadp"})]})})})},I=function(e){var t,n=e.authRoute,c=Object(a.useContext)(g).authState,r=c.loading,s=c.isAuthenticated;if(r)t=Object(l.jsx)(u,{});else{if(s)return Object(l.jsx)(d.a,{to:"/chat"});t=Object(l.jsxs)(l.Fragment,{children:["login"===n&&Object(l.jsx)(E,{}),"register"===n&&Object(l.jsx)(A,{})]})}return Object(l.jsx)("div",{className:"container container-fluid",children:t})},T=n(31),F=n(69),U=function(e){var t=e.conversation,n=e.currentUser,c=Object(a.useState)(null),r=Object(h.a)(c,2),s=r[0],i=r[1];return Object(a.useEffect)((function(){(function(){var e=Object(m.a)(b.a.mark((function e(){var a,c;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.members.find((function(e){return e!==n._id})),e.next=4,f.a.get("/api/auth?userId="+a);case 4:c=e.sent,i(c.data),e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(0),console.log(e.t0),new Error(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}})()()}),[n,t]),Object(l.jsx)("li",{className:"active",children:Object(l.jsxs)("div",{className:"d-flex bd-highlight",children:[Object(l.jsx)("div",{className:"img_cont",children:Object(l.jsx)("img",{src:null===s||void 0===s?void 0:s.avatar,className:"rounded-circle user_img",alt:"avatar"})}),Object(l.jsx)("div",{className:"user_info",children:Object(l.jsx)("span",{children:null===s||void 0===s?void 0:s.fullname})})]})})},M=n(71),R=n(70),D=n.n(R),H=function(e){var t=e.message,n=e.owner;return Object(l.jsxs)(a.Fragment,{children:[Object(l.jsx)("div",{className:n?"d-flex justify-content-end":"d-flex justify-content-start",children:Object(l.jsx)("div",{className:n?"msg_cotainer":"msg_cotainer_send",children:D.a.emojify(t.text)})}),Object(l.jsx)("span",{className:n?"msg_time_send ":"msg_time",children:Object(M.a)(t.createdAt)})]})},P=function(){var e=Object(a.useContext)(g),t=e.authState.user,n=e.logout,c=Object(a.useState)([]),r=Object(h.a)(c,2),s=r[0],i=r[1],o=Object(a.useState)(null),u=Object(h.a)(o,2),d=u[0],j=u[1],p=Object(a.useState)([]),O=Object(h.a)(p,2),x=O[0],v=O[1],N=Object(a.useState)(null),w=Object(h.a)(N,2),_=w[0],y=w[1],k=Object(a.useState)(""),S=Object(h.a)(k,2),C=S[0],E=S[1],A=Object(a.useState)(""),I=Object(h.a)(A,2),M=I[0],R=I[1],D=Object(a.useRef)(),P=function(){return n()},z=Object(a.useRef)();Object(a.useEffect)((function(){z.current=Object(F.io)("https://chat-chill.herokuapp.com"),z.current.on("get_message",(function(e){R({sender:e.senderId,text:e.text,createdAt:Date.now()})}))}),[]),Object(a.useEffect)((function(){M&&(null===d||void 0===d?void 0:d.members.includes(M.sender))&&v((function(e){return[].concat(Object(T.a)(e),[M])}))}),[M,d]),Object(a.useEffect)((function(){z.current.emit("add_user",t._id),z.current.on("get_users",(function(e){console.log(e)}))}),[t]),Object(a.useEffect)((function(){(function(){var e=Object(m.a)(b.a.mark((function e(){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.a.get("/api/conversation/"+t._id);case 3:n=e.sent,i(n.data),e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(0),console.log(e.t0),new Error(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}})()()}),[t._id]),Object(a.useEffect)((function(){(function(){var e=Object(m.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.a.get("/api/message/"+(null===d||void 0===d?void 0:d._id));case 3:t=e.sent,v(t.data),e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(0),console.log(e.t0),new Error(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}})()()}),[d]);var J=function(){var e=Object(m.a)(b.a.mark((function e(n){var a,c,r,s;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.preventDefault(),a=C.trim()){e.next=4;break}return e.abrupt("return");case 4:return c={sender:t._id,text:a,conversationId:d._id},r=d.members.find((function(e){return e!==t._id})),z.current.emit("send_message",{senderId:t._id,receiverId:r,text:a}),e.prev=7,e.next=10,f.a.post("/api/message",c);case 10:s=e.sent,v([].concat(Object(T.a)(x),[s.data])),E(""),e.next=19;break;case 15:throw e.prev=15,e.t0=e.catch(7),console.log(e.t0),new Error(e.t0);case 19:case"end":return e.stop()}}),e,null,[[7,15]])})));return function(t){return e.apply(this,arguments)}}(),B=function(){var e=Object(m.a)(b.a.mark((function e(n){var a,c,r,s;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("Enter"!==n.key){e.next=19;break}if(a=C.trim()){e.next=4;break}return e.abrupt("return");case 4:return c={sender:t._id,text:a,conversationId:d._id},r=d.members.find((function(e){return e!==t._id})),z.current.emit("send_message",{senderId:t._id,receiverId:r,text:a}),e.prev=7,e.next=10,f.a.post("/api/message",c);case 10:s=e.sent,v([].concat(Object(T.a)(x),[s.data])),E(""),e.next=19;break;case 15:throw e.prev=15,e.t0=e.catch(7),console.log(e.t0),new Error(e.t0);case 19:case"end":return e.stop()}}),e,null,[[7,15]])})));return function(t){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){var e;null===(e=D.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),[x]),Object(a.useEffect)((function(){(function(){var e=Object(m.a)(b.a.mark((function e(){var n,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=null===d||void 0===d?void 0:d.members.find((function(e){return e!==t._id})),console.log(n,"friendId"),!n){e.next=8;break}return e.next=6,f.a.get("/api/auth?userId="+n);case 6:a=e.sent,y(a.data);case 8:e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(0),console.log(e.t0),new Error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}})()()}),[d,t._id]),Object(l.jsx)(a.Fragment,{children:Object(l.jsx)("div",{className:"container-fluid h-100",children:Object(l.jsxs)("div",{className:"row justify-content-center h-100",children:[Object(l.jsx)("div",{className:"col-md-4 col-xl-3 chat",children:Object(l.jsxs)("div",{className:"card mb-sm-3 mb-md-0 contacts_card",children:[Object(l.jsxs)("div",{className:"card-header",children:[Object(l.jsxs)("div",{className:"d-flex bd-highlight",children:[Object(l.jsxs)("div",{className:"img_cont",children:[Object(l.jsx)("img",{src:t.avatar,className:"rounded-circle user_img",alt:"avatar"}),Object(l.jsx)("span",{className:"online_icon"})]}),Object(l.jsx)("div",{className:"user_info",children:Object(l.jsx)("span",{children:t.fullname})})]}),Object(l.jsxs)("div",{className:"input-group mt-3",children:[Object(l.jsx)("input",{type:"text",placeholder:"Search...",className:"form-control search",name:""}),Object(l.jsx)("div",{className:"input-group-prepend",children:Object(l.jsx)("span",{className:"input-group-text search_btn",children:Object(l.jsx)("i",{className:"fas fa-search"})})})]})]}),Object(l.jsx)("div",{className:"card-body contacts_body",children:Object(l.jsx)("ul",{className:"contacts",children:s.map((function(e){return Object(l.jsx)("div",{onClick:function(){return j(e)},children:Object(l.jsx)(U,{conversation:e,currentUser:t})},e._id)}))})})]})}),Object(l.jsx)("div",{className:"col-md-8 col-xl-6 chat",children:Object(l.jsx)("div",{className:"card",children:d?Object(l.jsxs)(a.Fragment,{children:[Object(l.jsxs)("div",{className:"card-header msg_head",children:[Object(l.jsxs)("div",{className:"d-flex bd-highlight",children:[Object(l.jsx)("div",{className:"img_cont",children:Object(l.jsx)("img",{src:null===_||void 0===_?void 0:_.avatar,className:"rounded-circle user_img",alt:""})}),Object(l.jsx)("div",{className:"user_info",children:Object(l.jsx)("span",{children:null===_||void 0===_?void 0:_.fullname})}),Object(l.jsxs)("div",{className:"video_cam",children:[Object(l.jsx)("span",{children:Object(l.jsx)("i",{className:"fas fa-video"})}),Object(l.jsx)("span",{children:Object(l.jsx)("i",{className:"fas fa-phone"})})]})]}),Object(l.jsx)("span",{id:"action_menu_btn",onClick:P,children:Object(l.jsx)("i",{className:"fas fa-sign-out-alt"})})]}),Object(l.jsx)("div",{className:"card-body msg_card_body",children:x.map((function(e){return Object(l.jsx)("div",{ref:D,children:Object(l.jsx)(H,{message:e,owner:e.sender===t._id},e._id)},e._id)}))}),Object(l.jsx)("div",{className:"card-footer",children:Object(l.jsxs)("div",{className:"input-group",children:[Object(l.jsx)("div",{className:"input-group-append",children:Object(l.jsx)("span",{className:"input-group-text attach_btn",children:Object(l.jsx)("i",{className:"fas fa-paperclip"})})}),Object(l.jsx)("input",{placeholder:"Type your message...",className:"form-control type_msg",name:"newMessage",value:C,onChange:function(e){return E(e.target.value)},onKeyDown:B}),Object(l.jsx)("div",{className:"input-group-append",children:Object(l.jsx)("span",{className:"input-group-text send_btn",onClick:J,children:Object(l.jsx)("i",{className:"fas fa-location-arrow"})})})]})})]}):Object(l.jsxs)(a.Fragment,{children:[Object(l.jsx)("div",{className:"card-header msg_head",children:Object(l.jsx)("span",{id:"action_menu_btn",onClick:P,children:Object(l.jsx)("i",{className:"fas fa-sign-out-alt"})})}),Object(l.jsxs)("div",{className:"alert alert-info alert-dismissible fade show mt-4",role:"alert",children:["M\u1eddi ch\u1ecdn cu\u1ed9c h\u1ed9i tho\u1ea1i",Object(l.jsx)("button",{type:"button",className:"close","data-dismiss":"alert","aria-label":"Close",children:Object(l.jsx)("span",{"aria-hidden":"true",children:"\xd7"})})]})]})})})]})})})};var z=function(){return Object(l.jsx)(N,{children:Object(l.jsx)("div",{className:"App",children:Object(l.jsx)(a.Suspense,{fallback:Object(l.jsx)("div",{children:"Loading ..."}),children:Object(l.jsx)(y.a,{children:Object(l.jsxs)(d.d,{children:[Object(l.jsx)(d.a,{exact:!0,from:"/",to:"/login"}),Object(l.jsx)(d.b,{exact:!0,path:"/login",render:function(e){return Object(l.jsx)(I,Object(i.a)(Object(i.a)({},e),{},{authRoute:"login"}))}}),Object(l.jsx)(d.b,{exact:!0,path:"/register",render:function(e){return Object(l.jsx)(I,Object(i.a)(Object(i.a)({},e),{},{authRoute:"register"}))}}),Object(l.jsx)(_,{path:"/chat",component:P})]})})})})})};n(132);s.a.render(Object(l.jsx)(c.a.StrictMode,{children:Object(l.jsx)(z,{})}),document.getElementById("root"))},78:function(e,t,n){}},[[133,1,2]]]);
//# sourceMappingURL=main.c5de9dd2.chunk.js.map